(function(e){function u(){ich.grabTemplates();a();f(c());l()}function a(){e.each(members,function(e,n){n.country=v(n.country);var r=ich.table_row(n);t.append(r)});n=e("#members").dataTable({aoColumns:[{sType:"emptybottom"},{sType:"emptybottom"},{sType:"emptybottom"},{sType:"emptybottom"},{sType:"emptybottom"},{sType:"emptybottom"},{sType:"emptybottom"}]})}function f(e){function c(){r=parseInt(d3.select("#map").style("width"));r=r-t.left-t.right;e=r*i;u.translate([r/2-20,e/2+e/50]).scale(r/400*70);l.style("width",r+"px").style("height",e+"px");l.selectAll(".unit").attr("d",a)}var t={top:10,left:10,bottom:10,right:10},r=parseInt(d3.select("#map").style("width")),r=r-t.left-t.right,i=.5,e=r*i;var u=d3.geo.winkel3().scale(r/400*70).translate([r/2-20,e/2+e/50]);var a=d3.geo.path().projection(u);var f=d3.scale.quantile().domain([0,85]).range(d3.range(5).map(function(e){return"q"+e+"-9"}));var l=d3.select("#map").insert("svg:svg","map").attr("width","100%").attr("height",e);d3.json(s,function(e,t){l.selectAll(".unit").data(topojson.feature(t,t.objects.combined).features).enter().append("path").attr("class",function(e){var t=e.properties.name;if(totals[t]&&regions[t]){summary_counts[regions[t]]["count"]+=totals[t];o[regions[t]]+=totals[t]}return"unit "+d(t)+" "+f(totals[t])}).attr("d",a).on("mouseenter",function(e,t){var n=e.properties.name;if(totals[n]){h(e.properties);d3.select(this).classed("hovered",true)}}).on("mouseleave",function(e,t){p();d3.select(this).classed("hovered",false)}).on("click",function(e){if(e.properties.postal){n.fnFilter(e.properties.postal)}else{n.fnFilter(e.properties.name)}})});d3.select(window).on("resize",c)}function l(){e(window).mousemove(function(e){var t=r.parent(),n=t.offset(),i=t.outerWidth()/2+n.left;var s=e.pageX-n.left+10,o=e.pageY-n.top+10,u=s>i?s-r.outerWidth()-10:s,a=o;r.css({left:u,top:a})})}function c(){return i.width()*.5}function h(e){r.find("#region").html("Region "+regions[e.name]);r.find("#member-total").html(totals[e.name]);r.find("#location").html(e.name);r.show()}function p(){r.hide()}function d(e){return e.replace(/[^-a-zA-Z0-9\s]+/ig,"").replace(/-/gi,"_").replace(/\s/gi,"-").toLowerCase()}function v(e){if(e!=="UAE"&&e!=="US"&&e!=="UK"){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}else{return e}}var t=e("#members"),n,r=e("#info-box"),i=e("#map");var s=window.location.href.indexOf("snd.org")===-1?"data/combined.json":"http://www.snd.org/assets/2013/snd-membership/combined.json";var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];jQuery.extend(jQuery.fn.dataTableExt.oSort,{"emptybottom-pre":function(e){return e},"emptybottom-asc":function(t,n){var r;t=e.trim(t);n=e.trim(n);if(t==n)r=0;else if(t==""||t==" ")r=1;else if(n==""||n==" ")r=-1;else if(t>n)r=1;else r=-1;return r},"emptybottom-desc":function(t,n){var r;t=e.trim(t);n=e.trim(n);if(t==n)r=0;else if(t==""||t==" ")r=-1;else if(n==""||n==" ")r=1;else if(t>n)r=1;else r=-1;return r}});u()})(jQuery);